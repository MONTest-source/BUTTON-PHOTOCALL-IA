<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Captura y escanea el QR de forma fácil y rápida">
    <meta name="keywords" content="Photocall, QR, Captura, Escaneo, Fácil, Rápido">
    <meta name="MappingON" content="Photocall">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <meta name="google" content="notranslate">
    <meta name="google" content="notranslate">
    <title>Photocall IA – Captura y QR</title>

    <link rel="icon" type="image/x-icon" href="pia-favicon.ico">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="app-container">
        <header class="header">
            <div class="logo-mon"><img src="logo.png" alt="MON Mapping ON"></div>
            <div class="header-content">
                <h1>Photocall IA</h1>
            </div>
        </header>

        <main class="main-content">
            <div class="content-card">
                <!-- Estado de Captura -->
                <div class="state-idle" id="state-idle">
                    <button class="btn-primary" id="capture-btn">CAPTURAR</button>
                </div>

                <!-- Estado Countdown -->
                <div class="state-countdown hidden" id="state-countdown">
                    <button class="btn-primary" disabled>Cuenta atrás</button>
                </div>

                <!-- Estado Listo para QR -->
                <div class="state-ready hidden" id="state-ready">
                    <button class="btn-primary" disabled>
                        <div id="qr-code-img"></div>
                    </button>
                </div>

                <!-- Estado de Error -->
                <div class="state-error hidden" id="state-error">
                    <p>Ha ocurrido un error inesperado.</p>
                    <button class="btn-primary" id="retry-btn">Reintentar</button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Conexión WebSocket
        let wsConnection = new WebSocket("ws://localhost:3000");

        wsConnection.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.type === 'progress') {
                // Mostrar progreso (no cambiar el QR aquí)
            } else if (data.type === 'ready') {
                // Mostrar el QR apuntando a la URL de Google Drive
                document.getElementById("qr-code-img").src = "https://drive.google.com/drive/folders/129rHzcKt_iJdfKLS9eim05wiYw_pfpMO";
                showState('state-ready');
            }
        };
    </script>
</body>

</html>